<div class="max-w-3xl mx-auto p-6">
  @if (survey()) {
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-indigo-900 mb-2">{{ survey()?.title }}</h1>
      <p class="text-gray-600 bg-white p-4 rounded-lg border-l-4 border-indigo-500 shadow-sm">
        {{ survey()?.description || '感謝您撥冗填寫此問卷。' }}
      </p>
    </div>

    <form [formGroup]="fillForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-6">
      @for (q of survey()?.questions; track q.id) {
        <mat-card class="p-4">
          <mat-card-header class="mb-4">
            <mat-card-title class="!text-lg">
              {{ $index + 1 }}. {{ q.title }}
              @if (q.required) {
                <span class="text-red-500 ml-1">*</span>
              }
            </mat-card-title>
          </mat-card-header>

          <mat-card-content>
            <!-- 1. 單選題 -->
            @if (q.type === 'SINGLE') {
              <mat-radio-group [formControlName]="q.id!" class="flex flex-col gap-3">
                @for (opt of q.options; track opt.id) {
                  <mat-radio-button [value]="opt.id">{{ opt.optionText }}</mat-radio-button>
                }
              </mat-radio-group>
            }

            <!-- 2. 多選題 -->
            @if (q.type === 'MULTI') {
              <div class="flex flex-col gap-3">
                @for (opt of q.options; track opt.id) {
                  <mat-checkbox (change)="onCheckboxChange(q.id!, opt.id!, $event.checked)">
                    {{ opt.optionText }}
                  </mat-checkbox>
                }
              </div>
            }

            <!-- 3. 簡答題 -->
            @if (q.type === 'TEXT') {
              <mat-form-field appearance="outline" class="w-full">
                <mat-label>您的回答</mat-label>
                <textarea matInput [formControlName]="q.id!" rows="3" placeholder="請在此輸入內容..."></textarea>
              </mat-form-field>
            }
          </mat-card-content>
        </mat-card>
      }

      <div class="flex justify-center gap-4 py-6">
        <button mat-button type="button" routerLink="/home">取消</button>
        <button mat-raised-button color="primary" type="submit" [disabled]="fillForm.invalid" class="px-8">
          提交問卷
        </button>
      </div>
    </form>
  } @else {
    <div class="text-center py-20">
      <p class="text-gray-500">正在讀取問卷內容...</p>
    </div>
  }
</div>
